<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>qpo EMS Preview</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
<!--
Webflow integration:
1. Voeg <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> en
   <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script> toe aan de site head.
2. Plaats <div class="emsPreview" data-intro="true"></div> in de pagina.
3. Kopieer de CSS naar custom CSS en de JS naar de footer custom code.
-->
<div class="emsPreview" data-intro="true">
<style>
:root{
  --qpo-bg:#121212;
  --qpo-grey:#888;
  --qpo-green:#4caf50;
  --qpo-green-light:rgba(76,175,80,0.3);
  --qpo-teal:#00bcd4;
  --qpo-bar:#1e1e1e;
  --qpo-font:'Arial',sans-serif;
}
.emsPreview{background:var(--qpo-bg);color:#fff;font-family:var(--qpo-font);max-width:600px;margin:auto;padding:1rem;}
@media(max-width:1024px){.qpo-emsGraph{display:none;}}
.qpo-emsGraph{position:relative;padding-bottom:60px;}
.qpo-chart{height:300px;}
.qpo-bar{position:absolute;left:0;right:0;bottom:0;background:var(--qpo-bar);display:flex;justify-content:space-around;padding:0.5rem;border-radius:0 0 8px 8px;}
.qpo-building{background:transparent;border:none;color:#fff;padding:0.25rem 0.5rem;border-radius:8px;display:flex;flex-direction:column;align-items:center;font-size:0.7rem;cursor:pointer;}
.qpo-building svg{width:24px;height:24px;margin-bottom:2px;}
.qpo-building.qpo-active{background:var(--qpo-teal);}
.qpo-annual-label{position:absolute;left:0;transform:translate(-100%,-50%);font-size:0.8rem;white-space:nowrap;}
.qpo-summary{background:#1e1e1e;padding:0.5rem;margin-top:0.5rem;border-radius:4px;}
.qpo-summary-line{display:flex;justify-content:space-between;margin-bottom:0.25rem;position:relative;}
.qpo-winst[data-qpo-tooltip]:hover::after{content:attr(data-qpo-tooltip);position:absolute;right:0;top:-1.5rem;background:#333;padding:0.25rem 0.5rem;border-radius:4px;font-size:0.7rem;white-space:nowrap;}
.qpo-controls{display:flex;justify-content:space-between;align-items:center;margin-top:0.5rem;}
.qpo-cta{margin-top:1rem;}
.qpo-modal{display:none;background:#222;padding:1rem;margin-top:1rem;border-radius:4px;text-align:center;}
.qpo-modal.qpo-show{display:block;}
</style>
  <div class="qpo-emsGraph">
    <canvas id="qpoChart" class="qpo-chart"></canvas>
    <div id="qpoLabelBaseline" class="qpo-annual-label" style="color:var(--qpo-grey);"></div>
    <div id="qpoLabelEMS" class="qpo-annual-label" style="color:var(--qpo-green);"></div>
    <div id="qpoBar" class="qpo-bar">
      <button class="qpo-building qpo-active" data-type="Woning">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/></svg>
        <span>Woning</span>
      </button>
      <button class="qpo-building" data-type="Winkeltje">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"/></svg>
        <span>Winkeltje</span>
      </button>
      <button class="qpo-building" data-type="Restaurant">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11,9H9V2H7V9H5V2H3V9C3,11.12 4.66,12.84 6.75,12.97V22H9.25V12.97C11.34,12.84 13,11.12 13,9V2H11V9M16,6V14H18.5V22H21V2C18.24,2 16,4.24 16,6Z"/></svg>
        <span>Restaurant</span>
      </button>
      <button class="qpo-building" data-type="Kantoorgebouw">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5m.75-9 3-3 2.148 2.148A12.061 12.061 0 0 1 16.5 7.605"/></svg>
        <span>Kantoorgebouw</span>
      </button>
      <button class="qpo-building" data-type="Winkelcentrum">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"/></svg>
        <span>Winkelcentrum</span>
      </button>
    </div>
  </div>
  <div class="qpo-summary">
    <div class="qpo-summary-line"><span>Zonder EMS</span><span id="qpoBaseCost"></span></div>
    <div class="qpo-summary-line"><span>Met EMS</span><span id="qpoEmsCost"></span></div>
    <div class="qpo-summary-line qpo-winst" id="qpoWin" data-qpo-tooltip="">
      <span>Winst</span><span><span id="qpoSavings"></span> (<span id="qpoSavingsPct"></span>)</span>
    </div>
  </div>
  <div class="qpo-controls">
    <label>Stap <input type="range" id="qpoStep" min="0" max="5" value="0"></label>
    <select id="qpoTariff">
      <option value="lineair">lineair</option>
      <option value="dynamisch">dynamisch</option>
      <option value="capaciteit">capaciteitstarief</option>
    </select>
  </div>
  <div class="qpo-cta">
    <!-- Start of Meetings Embed Script -->
    <div class="meetings-iframe-container" data-src="https://meetings-eu1.hubspot.com/lorenzo-grouw?embed=true"></div>
    <!-- End of Meetings Embed Script -->
  </div>
</div>
<script type="text/javascript" src="https://static.hsappstatic.net/MeetingsEmbed/ex/MeetingsEmbedCode.js"></script>
<script>
// Placeholder data: self-consumption 50-70% and peak reductions up to 50% based on Dutch pilots such as PowerMatching City, R4I and Jouw Energie Moment
// cite: Gercek et al. (2019), Debadarshini et al. (2022)
document.addEventListener('DOMContentLoaded',()=>{
  if(!document.querySelector('.emsPreview')) return;
  const qpoProfiles={
    'Woning':{baseline:[0.5,0.4,0.4,0.4,0.5,0.6,0.8,1.2,1.0,0.7,0.5,0.4,0.3,0.2,0.3,0.5,0.8,2.5,3.5,4.0,3.0,2.0,1.2,0.8]},
    'Winkeltje':{baseline:[0.3,0.3,0.3,0.3,0.4,0.8,1.5,2.0,3.0,3.5,3.5,3.2,3.0,3.0,3.2,3.5,3.5,3.0,2.0,1.5,1.0,0.6,0.4,0.3]},
    'Restaurant':{baseline:[1,1,1,1,1,1,2,3,4,5,6,6,5,4,5,8,8,6,4,3,2,1.5,1,1]},
    'Kantoorgebouw':{baseline:[2,2,2,2,2,4,8,10,12,12,12,12,12,12,12,12,10,8,4,2,2,2,2,2]},
    'Winkelcentrum':{baseline:[5,5,5,5,5,8,12,15,18,20,20,20,20,20,20,20,18,15,12,10,8,6,5,5]}
  };
  Object.keys(qpoProfiles).forEach(k=>{
    const base=qpoProfiles[k].baseline;
    const max=Math.max(...base);
    qpoProfiles[k].ems=base.map(v=> v>max*0.7 ? +(v*0.7).toFixed(2) : +(v*0.9).toFixed(2));
  });

  const qpoDynamicPrices=[0.22,0.20,0.18,0.18,0.17,0.16,0.15,0.14,0.13,0.15,0.20,0.25,0.30,0.32,0.35,0.33,0.28,0.26,0.24,0.23,0.22,0.21,0.20,0.19];
  const qpoTariffInfo={
    lineair:{price:0.26, tip:'Lineair tarief: vaste prijs per kWh.'},
    dynamisch:{prices:qpoDynamicPrices, tip:'Dynamisch tarief: prijs wisselt per uur.'},
    capaciteit:{monthly:3.37, tip:'Capaciteitstarief: kosten o.b.v. maandpiek.'}
  };

  const qpoCtx=document.getElementById('qpoChart').getContext('2d');
  const gradGrey=qpoCtx.createLinearGradient(0,0,0,300); gradGrey.addColorStop(0,'rgba(136,136,136,0.3)'); gradGrey.addColorStop(1,'rgba(136,136,136,0)');
  const gradGreen=qpoCtx.createLinearGradient(0,0,0,300); gradGreen.addColorStop(0,'rgba(76,175,80,0.4)'); gradGreen.addColorStop(1,'rgba(76,175,80,0)');
  const qpoChart=new Chart(qpoCtx,{type:'line',data:{labels:[...Array(24).keys()].map(h=>('0'+h).slice(-2)),datasets:[
    {label:'Zonder EMS',data:[],borderColor:varGet('--qpo-grey'),backgroundColor:gradGrey,tension:0.4,pointRadius:0,fill:false},
    {label:'Met EMS',data:[],borderColor:varGet('--qpo-green'),backgroundColor:gradGreen,tension:0.4,pointRadius:0,fill:-1}
  ]},options:{responsive:true,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:{callbacks:{afterBody:()=>document.getElementById('qpoTariff').value+' tarief'}}},scales:{x:{grid:{color:'#333'},ticks:{color:'#aaa'}},y:{grid:{color:'#333'},ticks:{color:'#aaa'},title:{display:true,text:'â‚¬ per uur',color:'#aaa'}}}}});

  function varGet(name){return getComputedStyle(document.documentElement).getPropertyValue(name).trim();}
  const qpoStep=document.getElementById('qpoStep');
  const qpoTariffSel=document.getElementById('qpoTariff');
  const qpoBaseCostEl=document.getElementById('qpoBaseCost');
  const qpoEmsCostEl=document.getElementById('qpoEmsCost');
  const qpoSavingsEl=document.getElementById('qpoSavings');
  const qpoSavingsPctEl=document.getElementById('qpoSavingsPct');
  const qpoWin=document.getElementById('qpoWin');
  const qpoLabelBaseline=document.getElementById('qpoLabelBaseline');
  const qpoLabelEMS=document.getElementById('qpoLabelEMS');
  let qpoCurrentType='Woning';

  function qpoUpdate(){
    const prof=qpoProfiles[qpoCurrentType];
    const baseline=prof.baseline;
    const emsFull=prof.ems;
    const step=+qpoStep.value;
    const factor=step/5;
    const ems=baseline.map((v,i)=> v-(v-emsFull[i])*factor);
    const tariff=qpoTariffSel.value;
    let prices,baseCosts,emsCosts;
    if(tariff==='lineair'){
      prices=Array(24).fill(qpoTariffInfo.lineair.price);
      baseCosts=baseline.map((v,i)=>v*prices[i]);
      emsCosts=ems.map((v,i)=>v*prices[i]);
    }else if(tariff==='dynamisch'){
      prices=qpoTariffInfo.dynamisch.prices;
      baseCosts=baseline.map((v,i)=>v*prices[i]);
      emsCosts=ems.map((v,i)=>v*prices[i]);
    }else{
      prices=Array(24).fill(qpoTariffInfo.lineair.price);
      baseCosts=baseline.map((v,i)=>v*prices[i]);
      emsCosts=ems.map((v,i)=>v*prices[i]);
      const peakBase=Math.max(...baseline);
      const peakEMS=Math.max(...ems);
      const dailyCapBase=qpoTariffInfo.capaciteit.monthly*peakBase/30;
      const dailyCapEMS=qpoTariffInfo.capaciteit.monthly*peakEMS/30;
      baseCosts[0]+=dailyCapBase;
      emsCosts[0]+=dailyCapEMS;
    }
    qpoChart.data.datasets[0].data=baseCosts;
    qpoChart.data.datasets[1].data=emsCosts;
    qpoChart.update();
    const dayBase=baseCosts.reduce((a,b)=>a+b,0);
    const dayEMS=emsCosts.reduce((a,b)=>a+b,0);
    const yearBase=dayBase*365;
    const yearEMS=dayEMS*365;
    qpoBaseCostEl.textContent='â‚¬'+yearBase.toFixed(0);
    qpoEmsCostEl.textContent='â‚¬'+yearEMS.toFixed(0);
    const saving=yearBase-yearEMS;
    qpoSavingsEl.textContent='â‚¬'+saving.toFixed(0);
    qpoSavingsPctEl.textContent=((saving/yearBase)*100).toFixed(1)+'%';
    qpoWin.setAttribute('data-qpo-tooltip',qpoTariffInfo[tariff].tip);
    qpoLabelBaseline.textContent='â‚¬'+yearBase.toFixed(0);
    qpoLabelBaseline.style.top='5%';
    qpoLabelEMS.textContent='â‚¬'+yearEMS.toFixed(0);
    qpoLabelEMS.style.top='15%';
  }

  document.querySelectorAll('#qpoBar .qpo-building').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('#qpoBar .qpo-building').forEach(b=>b.classList.remove('qpo-active'));
      btn.classList.add('qpo-active');
      qpoCurrentType=btn.getAttribute('data-type');
      qpoUpdate();
    });
  });
  qpoStep.addEventListener('input',qpoUpdate);
  qpoTariffSel.addEventListener('change',qpoUpdate);

  window.qpoLoadCsv=async function(url){
    const text=await fetch(url).then(r=>r.text());
    const rows=text.trim().split(/\r?\n/);
    const baseline=[],ems=[];
    rows.forEach(line=>{const [b,e]=line.split(',');baseline.push(parseFloat(b));ems.push(parseFloat(e));});
    qpoProfiles['CSV']={baseline,ems};
    qpoCurrentType='CSV';
    qpoUpdate();
  };

  qpoUpdate();
});
</script>
<!-- Replace placeholder profiles with your measured CSV using qpoLoadCsv('path/to/file.csv'). -->
</body>
</html>
