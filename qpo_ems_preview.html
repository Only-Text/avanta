<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>qpo EMS Preview</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<style>
:root{
  --qpo-bg:#121212;
  --qpo-grey:#888;
  --qpo-green:#4caf50;
  --qpo-teal:#00bcd4;
  --qpo-bar:#1e1e1e;
  --qpo-radius:20px;
  --qpo-font:"Inter",system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;
}
body{background:#0f0f0f;margin:0;padding:0;}
.emsPreview{
  background:var(--qpo-bg);
  color:#fff;
  font-family:var(--qpo-font);
  max-width:1200px;
  margin:0 auto;
  padding:1rem;
  border-radius:20px;
  overflow:hidden;
  box-sizing:border-box;
}
@media(max-width:1024px){.qpo-emsGraph{display:none;}}
.qpo-top-section{display:grid;grid-template-columns:1fr 220px;gap:1rem;}
.qpo-emsGraph{position:relative;}
.qpo-chart{width:100%;height:340px;}
.qpo-bar{
  background:var(--qpo-bar);
  display:flex;
  flex-direction:column;
  padding:0.75rem;
  border-radius:var(--qpo-radius);
  gap:8px;
}
.qpo-building{
  background:transparent;
  border:1px solid #333;
  color:#fff;
  padding:12px;
  border-radius:12px;
  display:flex;
  flex-direction:row;
  align-items:center;
  font-size:0.9rem;
  cursor:pointer;
  gap:12px;
  transition:.25s ease;
}
.qpo-building svg{width:26px;height:26px;margin:0;}
.qpo-building.qpo-active{
  background:var(--qpo-teal);
  color:#000;
}
.qpo-controls{display:flex;flex-wrap:wrap;gap:16px;margin-top:12px;font-size:0.8rem;align-items:flex-start;}
.qpo-slider-full{flex:1;min-width:220px;display:flex;flex-direction:column;gap:6px;}
.qpo-step-labels{display:flex;justify-content:space-between;font-size:0.6rem;margin-top:4px;letter-spacing:0.5px;}
input[type=range].qpo-range{
  -webkit-appearance:none;
  width:100%;
  height:12px;
  border-radius:6px;
  background:rgba(255,255,255,0.07);
  outline:none;
}
input[type=range].qpo-range::-webkit-slider-thumb{
  -webkit-appearance:none;
  appearance:none;
  width:24px;
  height:24px;
  border-radius:50%;
  background:var(--qpo-green);
  border:3px solid #fff;
  cursor:pointer;
  box-shadow:0 0 10px rgba(76,175,80,0.6);
}
input[type=range].qpo-range::-moz-range-thumb{
  width:24px;
  height:24px;
  border-radius:50%;
  background:var(--qpo-green);
  border:3px solid #fff;
  cursor:pointer;
  box-shadow:0 0 10px rgba(76,175,80,0.6);
}
.qpo-tariff-wrapper{
  min-width:160px;
  display:flex;
  flex-direction:column;
  gap:4px;
}
.qpo-tariff-label{font-size:0.75rem;margin-bottom:2px;font-weight:600;}
.qpo-tariff-select{
  background-image:linear-gradient(to bottom, #2a2a2a, #1e1e1e);
  border:1px solid #333;
  border-radius:8px;
  padding:10px;
  color:#fff;
  font-size:0.9rem;
  appearance:none;
}
.qpo-summary{
  background:#1e1e1e;
  padding:10px 12px;
  margin-top:12px;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:0.9rem;
}
.qpo-summary-line{display:flex;justify-content:space-between;align-items:center;gap:6px;}
.qpo-winst{font-weight:600;position:relative;}
.qpo-winst[data-qpo-tooltip]:hover::after{
  content:attr(data-qpo-tooltip);
  position:absolute;
  right:0;
  top:-2rem;
  background:rgba(50,50,50,0.95);
  padding:6px 10px;
  border-radius:6px;
  font-size:0.65rem;
  white-space:nowrap;
  z-index:10;
}
.qpo-meeting-embed{
  background:#1e1e1e;
  border-radius:12px;
  overflow:hidden;
  position:relative;
  min-height:380px;
  margin-top:16px;
}
.qpo-small{font-size:0.65rem;color:#bbb;margin-top:6px;line-height:1.1;}
.qpo-modal{
  display:none;
  background:#222;
  padding:14px;
  margin-top:14px;
  border-radius:10px;
  text-align:center;
  font-size:0.9rem;
}
.qpo-modal.qpo-show{display:block;}
</style>
<div class="emsPreview" data-intro="true" id="qpoRoot">
  <div style="font-size:1.35rem;font-weight:600;margin-bottom:6px;">Ontdek hoeveel uw gebouw bespaart met slim energiemanagement</div>
  <div style="font-size:0.85rem;margin-bottom:14px;">Kies gebouwtype, pas optimalisatie toe en plan meteen. Realtime inzicht in pieken en kosten.</div>

  <div class="qpo-top-section">
    <div class="qpo-emsGraph">
      <canvas id="qpoChart" class="qpo-chart"></canvas>
    </div>
    <div id="qpoBar" class="qpo-bar">
      <button class="qpo-building qpo-active" data-type="Woning" aria-label="Woning">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/>
        </svg>
        <span style="margin-top:2px;">Woning</span>
      </button>
      <button class="qpo-building" data-type="Winkeltje" aria-label="Winkeltje">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"/>
        </svg>
        <span style="margin-top:2px;">Winkeltje</span>
      </button>
      <button class="qpo-building" data-type="Restaurant" aria-label="Restaurant">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M11,9H9V2H7V9H5V2H3V9C3,11.12 4.66,12.84 6.75,12.97V22H9.25V12.97C11.34,12.84 13,11.12 13,9V2H11V9M16,6V14H18.5V22H21V2C18.24,2 16,4.24 16,6Z"/>
        </svg>
        <span style="margin-top:2px;">Restaurant</span>
      </button>
      <button class="qpo-building" data-type="Kantoorgebouw" aria-label="Kantoorgebouw">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5m.75-9 3-3 2.148 2.148A12.061 12.061 0 0 1 16.5 7.605"/>
        </svg>
        <span style="margin-top:2px;">Kantoorgebouw</span>
      </button>
      <button class="qpo-building" data-type="Winkelcentrum" aria-label="Winkelcentrum">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"/>
        </svg>
        <span style="margin-top:2px;">Winkelcentrum</span>
      </button>
    </div>
  </div>

  <div class="qpo-controls">
    <div class="qpo-slider-full">
      <div style="font-weight:600;margin-bottom:4px;">Optimalisatie niveau</div>
      <div class="qpo-slider-wrapper">
        <input type="range" id="qpoStep" class="qpo-range" min="0" max="5" value="0">
      </div>
      <div class="qpo-step-labels">
        <div>Geen EMS</div>
        <div>Volledige optimalisatie</div>
      </div>
    </div>
    <div class="qpo-tariff-wrapper">
      <div class="qpo-tariff-label">Energiecontract:</div>
      <select id="qpoTariff" class="qpo-tariff-select">
        <option value="lineair">Lineair</option>
        <option value="dynamisch">Dynamisch</option>
        <option value="capaciteit">Capaciteitstarief</option>
      </select>
    </div>
  </div>

  <div class="qpo-summary">
    <div class="qpo-summary-line"><div>Zonder EMS</div><div id="qpoBaseCost">–</div></div>
    <div class="qpo-summary-line"><div>Met EMS</div><div id="qpoEmsCost">–</div></div>
    <div class="qpo-summary-line qpo-winst" id="qpoWin" data-qpo-tooltip=""><div>Winst</div><div><span id="qpoSavings">–</span> (<span id="qpoSavingsPct">–</span>)</div></div>
  </div>

  <div class="qpo-meeting-embed">
    <!-- Start of Meetings Embed Script -->
    <div class="meetings-iframe-container" data-src="https://meetings-eu1.hubspot.com/lorenzo-grouw?uuid=98ce37ac-0850-454e-8a24-8baa2f206ebb" id="qpoHubspotEmbed"></div>
    <script type="text/javascript" src="https://static.hsappstatic.net/MeetingsEmbed/ex/MeetingsEmbedCode.js"></script>
    <!-- End of Meetings Embed Script -->
  </div>

  <div id="qpoSuccess" class="qpo-modal">
    <div style="font-weight:600;margin-bottom:6px;">Uw afspraak is bevestigd!</div>
    <div>U ontvangt uw persoonlijke analyse en Teams-link per e-mail.</div>
    <div style="margin-top:6px;font-size:0.75rem;">Vragen? Mail naar info@avanta.nl</div>
  </div>

  <div class="qpo-small">
    Deze simulatie is gebaseerd op gemiddelde praktijkdata. Voor exacte cijfers kunt u later echte meetprofielen laden of handmatig data vervangen.
  </div>
</div>

<script>
// Data & logica
function qpoVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

document.addEventListener('DOMContentLoaded', ()=>{
  const qpoProfiles = {
    'Woning': {
      baseline: [0.6,0.5,0.5,0.5,0.6,0.9,1.5,2.7,2.0,1.2,0.8,0.6,0.4,0.3,0.4,0.7,1.3,3.8,4.5,5.0,3.8,2.5,1.6,1.0],
      ems:      [0.55,0.45,0.45,0.45,0.55,0.8,1.2,2.0,1.7,1.0,0.7,0.55,0.35,0.25,0.35,0.6,1.0,2.8,3.3,3.6,2.8,1.9,1.2,0.9]
    },
    'Winkeltje': {
      baseline: [0.4,0.35,0.35,0.4,0.6,1.2,2.5,4.0,5.5,6.5,6.0,5.5,5.5,5.5,5.8,6.5,6.5,5.0,3.8,2.5,1.8,1.0,0.6,0.5],
      ems:      [0.35,0.3,0.3,0.35,0.55,1.0,2.0,3.2,4.4,5.2,4.8,4.3,4.3,4.3,4.6,5.2,5.2,4.0,3.0,2.0,1.5,0.9,0.55,0.45]
    },
    'Restaurant': {
      baseline: [1.5,1.2,1.2,1.3,1.5,2.5,4.0,6.0,8.0,9.5,10,10,9.5,8.0,8.5,10,10,8.0,6.5,4.5,3.0,2.0,1.5,1.2],
      ems:      [1.3,1.0,1.0,1.1,1.3,2.0,3.2,4.8,6.4,7.6,8.0,8.0,7.5,6.4,6.8,8.0,8.0,6.4,5.2,3.6,2.4,1.6,1.3,1.0]
    },
    'Kantoorgebouw': {
      baseline: [3,2.5,2.5,2.5,3,6,12,18,22,24,24,24,23,22,22,24,22,18,10,6,4,3,2.5,2.5],
      ems:      [2.6,2.2,2.2,2.2,2.6,5,9,13,16,17,17,17,16,15,15,16,15,13,8,5,3.5,2.8,2.2,2.2]
    },
    'Winkelcentrum': {
      baseline: [6,6,6,6,8,12,20,28,34,38,38,38,37,35,35,38,35,28,20,14,10,7,6,6],
      ems:      [5.2,5.0,5.0,5.0,7,10,16,22,27,30,30,30,29,27,27,30,27,22,16,11,8,6,5,5]
    }
  };

  const qpoDynamicPrices = [0.22,0.20,0.18,0.18,0.17,0.16,0.15,0.14,0.13,0.15,0.20,0.25,0.30,0.32,0.35,0.33,0.28,0.26,0.24,0.23,0.22,0.21,0.20,0.19];
  const qpoTariffInfo = {
    lineair: { price:0.26, tip:'Lineair tarief: vaste prijs per kWh.' },
    dynamisch: { prices:qpoDynamicPrices, tip:'Dynamisch tarief: prijs wisselt per uur.' },
    capaciteit: { monthly:3.37, tip:'Capaciteitstarief: kosten gebaseerd op maandpiek.' }
  };

  const qpoStep = document.getElementById('qpoStep');
  const qpoTariffSel = document.getElementById('qpoTariff');
  const qpoBaseCostEl = document.getElementById('qpoBaseCost');
  const qpoEmsCostEl = document.getElementById('qpoEmsCost');
  const qpoSavingsEl = document.getElementById('qpoSavings');
  const qpoSavingsPctEl = document.getElementById('qpoSavingsPct');
  const qpoWin = document.getElementById('qpoWin');
  const qpoOpenScheduler = document.getElementById('qpoOpenScheduler');
  let qpoCurrentType = 'Woning';

  const ctx = document.getElementById('qpoChart').getContext('2d');
  const gradientGrey = ctx.createLinearGradient(0,0,0,360);
  gradientGrey.addColorStop(0,'rgba(136,136,136,0)');
  gradientGrey.addColorStop(1,'rgba(136,136,136,0.15)');
  const gradientGreen = ctx.createLinearGradient(0,0,0,360);
  gradientGreen.addColorStop(0,'rgba(76,175,80,0)');
  gradientGreen.addColorStop(1,'rgba(76,175,80,0.15)');
  const qpoChart = new Chart(ctx, {
    type:'line',
    data:{
      labels:[...Array(24).keys()].map(h=>('0'+h).slice(-2)+':00'),
      datasets:[
        { label:'Zonder EMS', data:[], borderColor: qpoVar('--qpo-grey'), backgroundColor: gradientGrey, tension:0.4, pointRadius:0, fill:true, borderWidth:2 },
        { label:'Met EMS', data:[], borderColor: qpoVar('--qpo-green'), backgroundColor: gradientGreen, tension:0.4, pointRadius:0, fill:true, borderWidth:2 }
      ]
    },
    options:{
      responsive:true,
      interaction:{mode:'index',intersect:false},
      plugins:{
        legend:{display:false},
        tooltip:{
          padding:8,
          backgroundColor:'#222',
          titleColor:'#fff',
          bodyColor:'#fff',
          callbacks:{
            label(ctx){ return ctx.dataset.label+': '+ctx.parsed.y.toFixed(2)+' €'; },
            afterBody(){ return qpoTariffInfo[qpoTariffSel.value].tip; }
          }
        }
      },
      scales:{
        x:{grid:{color:'#333'},ticks:{color:'#aaa'},title:{display:true,text:'Tijd van dag',color:'#aaa'}},
        y:{grid:{color:'#333'},ticks:{color:'#aaa'},title:{display:true,text:'Kosten (€)',color:'#aaa'}}
      }
    }
  });

  function qpoUpdate(){
    const prof = qpoProfiles[qpoCurrentType];
    const baseline = prof.baseline;
    const emsFull = prof.ems;
    const step = +qpoStep.value;
    const factor = step/5;
    const ems = baseline.map((v,i)=> v - (v - emsFull[i]) * factor);
    const tariff = qpoTariffSel.value;
    let baseCosts = [], emsCosts = [];

    if(tariff==='lineair'){
      baseCosts = baseline.map(v=> v * qpoTariffInfo.lineair.price);
      emsCosts = ems.map(v=> v * qpoTariffInfo.lineair.price);
    } else if(tariff==='dynamisch'){
      baseCosts = baseline.map((v,i)=> v * qpoTariffInfo.dynamisch.prices[i]);
      emsCosts = ems.map((v,i)=> v * qpoTariffInfo.dynamisch.prices[i]);
    } else {
      baseCosts = baseline.map(v=> v * qpoTariffInfo.lineair.price);
      emsCosts = ems.map(v=> v * qpoTariffInfo.lineair.price);
      const peakBase = Math.max(...baseline);
      const peakEMS = Math.max(...ems);
      const dailyCapBase = (qpoTariffInfo.capaciteit.monthly * peakBase)/30;
      const dailyCapEMS = (qpoTariffInfo.capaciteit.monthly * peakEMS)/30;
      baseCosts[0] += dailyCapBase;
      emsCosts[0] += dailyCapEMS;
    }

    qpoChart.data.datasets[0].data = baseCosts;
    qpoChart.data.datasets[1].data = emsCosts;
    qpoChart.update();

    const dayBase = baseCosts.reduce((a,b)=>a+b,0);
    const dayEMS = emsCosts.reduce((a,b)=>a+b,0);
    const yearBase = dayBase * 365;
    const yearEMS = dayEMS * 365;
    const saving = yearBase - yearEMS;
    const pct = yearBase>0?((saving/yearBase)*100).toFixed(1):'0.0';

    document.getElementById('qpoBaseCost').textContent='€'+Math.round(yearBase).toLocaleString('nl-NL');
    document.getElementById('qpoEmsCost').textContent='€'+Math.round(yearEMS).toLocaleString('nl-NL');
    document.getElementById('qpoSavings').textContent='€'+Math.round(saving).toLocaleString('nl-NL');
    document.getElementById('qpoSavingsPct').textContent=pct+'%';
    qpoWin.setAttribute('data-qpo-tooltip', qpoTariffInfo[tariff].tip);
  }

  document.querySelectorAll('.qpo-building').forEach(b=>{
    b.addEventListener('click', ()=>{
      document.querySelectorAll('.qpo-building').forEach(x=>x.classList.remove('qpo-active'));
      b.classList.add('qpo-active');
      qpoCurrentType = b.getAttribute('data-type');
      qpoUpdate();
    });
  });
  qpoStep.addEventListener('input', qpoUpdate);
  qpoTariffSel.addEventListener('change', qpoUpdate);

  // init
  qpoUpdate();
});
</script>
</body>
</html>
